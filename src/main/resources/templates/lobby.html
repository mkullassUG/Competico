<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v4.1.1">
    <title>index</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/cover/">
    <link rel="icon" href="./assets/myIcons/icon.svg">
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/lobby.css" rel="stylesheet">
  </head>

  <body class="bg-primary">
    <!-- Modal -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="exampleModalLongTitle">Ustawienia Lobby</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <label for="inputMaxPlayers" class="col-form-label">Max graczy:</label>
            <input type="number" class="form-control" id="inputMaxPlayers" value="10">

            <hr>
            <label for="lobbyVisibility" class="col-form-label">Widoczność lobby:</label>
            <select id="lobbyVisibility">
              <option>Publiczne</option>
              <option>Prywatne</option>
              <option>Testowe</option>
            </select>
            <hr>
            <h5>Pozostałe opcje</h5>
            <p>...</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnSaveSettings">Save changes</button>
          </div>
        </div>
      </div>
    </div>
    <!-- loading modal -->
    <div class="hideBeforeLoadModal fade bd-example-modal-lg" data-backdrop="static" data-keyboard="false" tabindex="-1">
      <div class="modal-dialog modal-sm">
          <div class="modal-content" style="width: 48px">
              <span class="fa fa-spinner fa-spin fa-3x"></span>
          </div>
      </div>
    </div>
    <!-- main content -->
    <div class="container fill text-center hideBeforeLoad">
      <div class="row shadow-sm rounded" id="lobbyTop">
        <div class="col-3">
          <buton class="btn btn-sm btn-secondary" id="btnCopyCode">Kopiuj kod</buton>
        </div>
        <div class="col-9">
          <h2 id="lobbyCode" class="text-white">Kod: 123456789</h2>
        </div>
      </div>
      <div class="row shadow-sm mt-3 rounded" id="lobbyCenter">
        <div class="col-2 shadow-sm" id="lobbySettings">
          
          <button type="button" id="btnSettings" class="btn btn-secondary collapse" data-toggle="modal" data-target="#exampleModalCenter">
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-gear" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M8.837 1.626c-.246-.835-1.428-.835-1.674 0l-.094.319A1.873 1.873 0 0 1 4.377 3.06l-.292-.16c-.764-.415-1.6.42-1.184 1.185l.159.292a1.873 1.873 0 0 1-1.115 2.692l-.319.094c-.835.246-.835 1.428 0 1.674l.319.094a1.873 1.873 0 0 1 1.115 2.693l-.16.291c-.415.764.42 1.6 1.185 1.184l.292-.159a1.873 1.873 0 0 1 2.692 1.116l.094.318c.246.835 1.428.835 1.674 0l.094-.319a1.873 1.873 0 0 1 2.693-1.115l.291.16c.764.415 1.6-.42 1.184-1.185l-.159-.291a1.873 1.873 0 0 1 1.116-2.693l.318-.094c.835-.246.835-1.428 0-1.674l-.319-.094a1.873 1.873 0 0 1-1.115-2.692l.16-.292c.415-.764-.42-1.6-1.185-1.184l-.291.159A1.873 1.873 0 0 1 8.93 1.945l-.094-.319zm-2.633-.283c.527-1.79 3.065-1.79 3.592 0l.094.319a.873.873 0 0 0 1.255.52l.292-.16c1.64-.892 3.434.901 2.54 2.541l-.159.292a.873.873 0 0 0 .52 1.255l.319.094c1.79.527 1.79 3.065 0 3.592l-.319.094a.873.873 0 0 0-.52 1.255l.16.292c.893 1.64-.902 3.434-2.541 2.54l-.292-.159a.873.873 0 0 0-1.255.52l-.094.319c-.527 1.79-3.065 1.79-3.592 0l-.094-.319a.873.873 0 0 0-1.255-.52l-.292.16c-1.64.893-3.433-.902-2.54-2.541l.159-.292a.873.873 0 0 0-.52-1.255l-.319-.094c-1.79-.527-1.79-3.065 0-3.592l.319-.094a.873.873 0 0 0 .52-1.255l-.16-.292c-.892-1.64.902-3.433 2.541-2.54l.292.159a.873.873 0 0 0 1.255-.52l.094-.319z"></path>
              <path fill-rule="evenodd" d="M8 5.754a2.246 2.246 0 1 0 0 4.492 2.246 2.246 0 0 0 0-4.492zM4.754 8a3.246 3.246 0 1 1 6.492 0 3.246 3.246 0 0 1-6.492 0z"></path>
            </svg>
          </button>
        </div>
        <div class="col-10" id="lobbyMainHost">
          <div id="lobbyHost" class="d-flex align-items-center p-3 my-3 text-dark-50 bg-light rounded shadow-sm">
            <div class="col-12">
              <h6 class="border-bottom border-gray pb-2 mb-0">
                <img class="mr-3" src="assets/myIcons/iconfinder_law_iconsArtboard_1_copy_5_2393033.svg" alt="" width="48" height="48">
                Host:
              </h6>
              <div class="lh-100">
                <h6 class="mb-0 text-dark lh-100" id="lobbyHostUsername">@username</h6>
                <small></small>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12" id="lobbyMainPlayerList">
          <div id="lobbyPlayerList" class="my-3 p-3 bg-light rounded shadow-sm overflow-auto">
            <h6 class="border-bottom border-gray pb-2 mb-0 text-dark" id="lobbyMaxPlayers">Gracze</h6>
            <div class="media text-muted pt-3 player">
              <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
              <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong class="text-gray-dark">Full Name</strong>
                  <a href="#">Usuń</a>
                </div>
                <span class="d-block">@username</span>
              </div>
            </div>
            <div class="media text-muted pt-3 player">
              <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
              <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong class="text-gray-dark">Full Name</strong>
                  <a href="#">Usuń</a>
                </div>
                <span class="d-block">@username</span>
              </div>
            </div>
            <div class="media text-muted pt-3 player">
              <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
              <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong class="text-gray-dark">Full Name</strong>
                  <a href="#">Usuń</a>
                </div>
                <span class="d-block">@username</span>
              </div>
            </div>
            <div class="media text-muted pt-3 player">
              <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
              <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong class="text-gray-dark">Full Name</strong>
                  <a href="#">Usuń</a>
                </div>
                <span class="d-block">@username</span>
              </div>
            </div>
            <div class="media text-muted pt-3 player">
              <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
              <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong class="text-gray-dark">Full Name</strong>
                  <a href="#">Usuń</a>
                </div>
                <span class="d-block">@username</span>
              </div>
            </div>
            <div class="media text-muted pt-3 player">
              <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
              <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong class="text-gray-dark">Full Name</strong>
                  <a href="#">Usuń</a>
                </div>
                <span class="d-block">@username</span>
              </div>
            </div>
            <div class="media text-muted pt-3 player">
              <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
              <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong class="text-gray-dark">Full Name</strong>
                  <a href="#">Usuń</a>
                </div>
                <span class="d-block">@username</span>
              </div>
            </div>
            <div class="media text-muted pt-3 player">
              <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
              <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong class="text-gray-dark">Full Name</strong>
                  <a href="#">Usuń</a>
                </div>
                <span class="d-block">@username</span>
              </div>
            </div>
            <div class="media text-muted pt-3 player">
              <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
              <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong class="text-gray-dark">Full Name</strong>
                  <a href="#">Usuń</a>
                </div>
                <span class="d-block">@username</span>
              </div>
            </div>
            <div class="media text-muted pt-3 player">
              <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
              <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong class="text-gray-dark">Full Name</strong>
                  <a href="#">Usuń</a>
                </div>
                <span class="d-block">@username</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row shadow-sm mt-3 rounded" id="lobbyBottom">
        <div class="col-3">
          <buton class="btn btn-lg btn-secondary mb-3" id="btnLeave">Wyjdź z lobby</buton>
        </div>
        <div class="col-5">
        </div>
        <div class="col-4">
          <buton class="btn btn-lg btn-secondary collapsed mb-3" id="btnStart">Rozpocznij gre</buton>
        </div>
      </div>
      <!-- game -->
      <div class="row shadow-sm collapse" id="gameTop">
        <div class="col-12">
          <div id="gameTimer">Timer</div>
        </div>
      </div>
      <div class="row shadow-sm mt-3 collapse" id="gameCenter">
        <div class="col-12">
          <!-- Task templates -->
          <div class="collapse" id="template0">
            <div class="taskContext">
              Dokończ słowa template0
            </div>
            <div class="interactable">
              <div class="textField">

              </div>
            </div>
          </div>
          <div class="collapse" id="template1">
            <div class="taskContext">
              template1
            </div>
            <div class="interactable">

            </div>
          </div>
          <div class="collapse" id="template2">
            <div class="taskContext">
              template2
            </div>
            <div class="interactable">

            </div>
          </div>
          <div class="collapse" id="template3">
            <div class="taskContext">
              template3
            </div>
            <div class="interactable">

            </div>
          </div>
        </div>
      </div>
      <div class="row shadow-sm mt-3 collapse" id="gameEndCenter">
        <div class="col-12">
            <div class="lobbyDashboard">
              <h2 class="text-white">Dziękuje za grę</h2> 
              <div id="endGameDashboard">
                (lobbyDashboard)
              </div>
            </div>
        </div>
      </div>
      <div class="row shadow-sm mt-3 collapse" id="gameBottom">
        <div class="col-12">
          <buton class="btn btn-lg btn-secondary mb-3" id="btnNextTask">Nastepne zadanie</buton>
        </div>
      </div>
      <div class="row shadow-sm mt-3 collapse" id="gameEndBottom">
        <div class="col-12">
          <buton class="btn btn-lg btn-secondary mb-3" id="btnEndGame">Zakończ grę</buton>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container text-center">
        <span class="text-muted m-auto">Ucz się angielskiego razem z nami <img src="./assets/myIcons/iconbigblack.svg" class="iconbig" style=" filter: invert(25%);"></span>
      </div>
    </footer>
  </body>
</html>
<script src="js/jquery-3.5.1.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script>
  
  const LobbyLogic = ( debug = false) => {

    /*       logic variables          */
    var self = {};
    var lobbySettings = {
      maxPlayers: 10,
      lobbyVisibility: "Publiczne"
    }

    var lobbyTop = $("#lobbyTop");
    var lobbyCenter = $("#lobbyCenter");
    var lobbyBottom = $("#lobbyBottom");
    var isHost;
    var isLecturer; //For future implementation of lecturer
    var debug = debug;
    var gameStatus = "not started";
    var gameStarted;
    var currentTemplateDivId;
    var currentTemplate;
    var dateOfGameStart;//For future implementation of Timer
    var ajaxLoopTimeout;
    var timerLoop;//For future implementation of Timer
    var lobbyCode;
    var nickname;

    var gameTop = $("#gameTop");
    var gameCenter = $("#gameCenter");
    var gameBottom = $("#gameBottom");

    /*       logic functions          */
    var lobbyInit = (data) => {

      isHost = data.isHost; 
      nickname = data.nickname; 
      gameStarted = data.gameStarted;

      if (!data.logged)
        window.location = "/login";
      if (isHost) {
        $("#btnStart").show();
        $("#btnSettings").show();
        $("#lobbyHostUsername").html(nickname);
      } else {

        $("#lobbyMainHost").removeClass("col-10").addClass("col-12");
        $("#lobbySettings").hide();
      }
      
      if (gameStarted) {
        gameStatus = "started";
        ajaxReceiveGameChange(); //nie wiem czy potrzebne... nie jeśli serwer będzie wiedział że ktośwyszedł i wrócił i trzeba mu dać znać w connectionLoopie
        
      }

      $('.btn').popover();

      //ustaw kod
      lobbyCode = window.location.href.substring(this.location.href.lastIndexOf('/') + 1);
      $("#lobbyCode").html("Kod: " + lobbyCode);
      ajaxReceiveLobbyChange();
      $('.hideBeforeLoad').fadeIn();

      
      ajaxLoopTimeout = setTimeout(ajaxConnectionLoop,1000);
    }
    var startGame = () => {
      lobbyTop.hide();
      lobbyCenter.hide();
      lobbyBottom.hide();

      gameTop.show();
      gameCenter.show();
      gameBottom.show();
    }
    var copyTextToClipboard = (text) => {
      var textArea = document.createElement("textarea");
      textArea.value = text
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();

      try {
        var successful = document.execCommand('copy');
        var msg = successful ? 'successful' : 'unsuccessful';
        if (debug)
          console.log('Copying text command was ' + msg);
      } catch (err) {
        if (debug)
          console.log('Oops, unable to copy');
      }

      document.body.removeChild(textArea);
    }

    var gameSetupAfterChange = (game) => {
      /*game:
      {
        -task: {
          id: //wybiera odpowiednie id przypisane to template'u
          [pozostałe wartości odpowiednie dla danego template'u]
        }
        -time: //czas rozpoczęcia gry, potrzebny tylko na starcie,
        -hasEnded: true //posiada tylko jeśli gra się zakończyła i oddało się ostatnie zadanie... jeszcze do uzgodnienia z Michałem jak to będzie ogarnięte
        -result: //wyniki graczy wyświetlane na poczekalni po zakonczeniu gry
      }*/
      //setup task
      if (gameStatus == "not started") {
        gameStatus = "started";
        startGame();
        dateOfGameStart = game.time;
        setupNewTask(game.task);
      } else if ( game.hasEnded != null && game.hasEnded == true){
        gameStatus = "ended";
        setupEndGame(game);
      } else {
        gameStatus = "another task";
        setupNewTask(game.task);
      }
    }
    var lobbySetupAfterChange = (lobby) => {
      /*
      lobby: 
      {
        playerList: //tablica obiektów graczy z których można odczytać np "name"
        maxPlayers: //jedno z ustawień lobby
        whoIsHost: nazwa obecnego hosta lobby
      }
      */
      //setup lobby
      
      $("#lobbyHostUsername").html(lobby.whoIsHost);
      //------player list
      $("#lobbyPlayerList > .player").remove();
      let playerListLength = lobby.playerList.length;
      for (let i = 0; i < playerListLength; i++) {
        let player = lobby.playerList[i];
        let playerDiv = $(`<div class="media text-muted pt-3 player">
              <svg class="bd-placeholder-img mr-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: 32x32"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"></rect><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>
              <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong class="text-gray-dark">Full Name</strong>
                  <a href="" class="btnKick" data-username="` + player.name + `">Usuń</a>
                </div>
                <span class="d-block">@username</span>
              </div>
            </div>`);
        $("#lobbyPlayerList").append(playerDiv);
      }
      
      $(".btnKick").on("click", (e) => {
        e.preventDefault();

        sendAjaxKickPlayer($(e.target).data("username"));

        if (debug == true)
          console.log("kicking: " + $(e.target).data("username"));
      });
      
      //-----max players
      if (lobby.maxPlayers != null) {
        $("#lobbyMaxPlayers").val("Gracze " + playerListLength + "\\" + lobby.maxPlayers);
      }
      //... pozostałe zmiany jakie mogą zajść w lobby dodac poniżej
    }
    var updateCheck = (data) => {
      if(data.game == true) 
        ajaxReceiveGameChange();
      if (data.lobby == true)
        ajaxReceiveLobbyChange();
    } 
    var finishTask = () => {
      var answers = {};

      var inputFields = $("#" + currentTemplateDivId).find(".inputField");
      var testField = $("#" + currentTemplateDivId).find(".textField");
      for (let i = 0; i < inputFields.length; i++) {
        //jeśli będzie potrzeba rozpoznawać ospowiedzi po jakimś id otrzymanym od serwera
        //var inputFieldId = inputFields[i].data("fieldId"); 
        //answers[inputFieldId] = inputFields[i].value();
        answers[i] = $(inputFields[i]).val();
      }
      var testField = $("#" + currentTemplateDivId).find(".textField").html("");
      
      ajaxSendAnswerAndReceiveNext(answers);
    }
    var setupNewTask = (task) => {

      if (task == null) {
        if (debug)
          console.log("task was empty");
        return;
      }
      /*
        TODO
        przetestować podmiane taska, (mogą być błędy)
      */
      for (let i = 0; i < taskTemplates.length; i++) {
        $("#" + taskTemplates[i].nameId).hide();
        $("#" + taskTemplates[i].nameId).find(".inputField").val("");
        $("#" + taskTemplates[i].nameId).find(".textField").html("");
      }


      currentTemplate = taskTemplates.find((e)=>e.taskId == task.taskId)
      currentTemplateDivId = currentTemplate.nameId;

      var templateDivElement = $("#" + currentTemplateDivId);
      templateDivElement.show();

      //wybieranie odpowiedniej logiki dla konkretnego template'a
      switch (currentTemplate.nameId) {
        case "template0":
          currentTemplate.textField = task.textField;
          currentTemplate.inputSymbolDetection = task.inputSymbolDetection;
          currentTemplate.firstLetters = task.firstLetters;
          
          var regexp = new RegExp(currentTemplate.inputSymbolDetection , "g");
          var i = 0;
          var newTextFieldString = currentTemplate.textField.replace(regexp, function() { return '<input type="text" class="inputField" value="' + currentTemplate.firstLetters[i] + '">' + (i++); });

          templateDivElement.find(".textField").html(newTextFieldString);
          break;
        case "template1":

          break;
      }
    }
    var setupEndGame = (game) => {

      $("#gameEndCenter").show();
      $("#gameEndBottom").show();
      $("#gameCenter").hide();
      $("#gameBottom").hide();
      $("#gameTimer").hide();
      if (game.result) {
        //jeszcze nie jestem pewien w jakiej postaci będa przesyłane wyniki obecnego i pozostałych graczy. Do uzgodnienia z Michałem
        $("#endGameDashboard").html("Twój wynik: " + game.result); 
      }

    }
    var updateLobbySettingsAsHost = () => {
      
      lobbySettings.maxPlayers = $("#inputMaxPlayers").val();
      lobbySettings.lobbyVisibility = $("#lobbyVisibility").val();
      //... pozostałe ustawienia które można dodać poniżej
    }
    /*       event listeners          */
    $("#btnStart").on("click",()=>{
      if (debug)
        console.log("btnStart");

      if (isHost == true)
        sendAjaxStart();
    });
    $("#btnLeave").on("click",()=>{
      if (debug)
        console.log("btnLeave")
      sendAjaxLeave();
    });
    $("#btnNextTask").on("click",(e) => {
      if (debug)
        console.log("btnNextTask")

      if (gameStatus != "not started" && gameStatus != "ended")
        finishTask();
    })
    $("#btnCopyCode").on("click",(e) => {
      if (debug == true)
        console.log("btnCopyCode")

      copyTextToClipboard(lobbyCode);
    })
    $("#btnSaveSettings").on("click",()=>{
      if (debug)
        console.log("btnSaveSettings");

      if (isHost == true)
        sendAjaxSettingsChange();
    });
    $("#btnEndGame").on("click",()=>{
      if (debug)
        console.log("btnEndGame");

      if (gameStatus == "ended")
        sendAjaxEndGame();
    });
    
    /*     ajax http actions       */
    var sendAjaxStart = () => {
      if (isHost == false)
        return;
      $('.hideBeforeLoadModal').modal('show');
      var send = {}
      $.ajax({
        type     : "POST",
        cache    : false,
        url      : "game/start",
        data     : JSON.stringify(send),
        contentType: "application/json",
        success: function(data, textStatus, jqXHR) {
          if (debug)
            console.log("sendAjaxStart success");
          
          $(".hideBeforeLoadModal").on('shown.bs.modal', function() { $(".hideBeforeLoadModal").modal('hide'); }).modal('hide');
        },
        error: function(jqXHR, status, err) {
          if (debug)
            console.log("sendAjaxStart error");
          
          $(".hideBeforeLoadModal").on('shown.bs.modal', function() { $(".hideBeforeLoadModal").modal('hide'); }).modal('hide');
        }
      });
    }
    var sendAjaxLeave = () => {
      var send = {}
      $.ajax({
        type     : "POST",
        cache    : false,
        url      : "game/leave",
        data     : JSON.stringify(send),
        contentType: "application/json",
        success: function(data, textStatus, jqXHR) {
          if (debug)
            console.log("sendAjaxLeave success");
        },
        error: function(jqXHR, status, err) {
          if (debug)
            console.log("sendAjaxLeave error");
        }
      });
    }
    var sendAjaxKickPlayer = (player) => {
      if (isHost == false)
        return;

      var send = {player: player}
      $.ajax({
        type     : "POST",
        cache    : false,
        url      : "game/kick",
        data     : JSON.stringify(send),
        contentType: "application/json",
        success: function(data, textStatus, jqXHR) {
          if (debug)
            console.log("sendAjaxKickPlayer success");
        },
        error: function(jqXHR, status, err) {
          if (debug)
            console.log("sendAjaxKickPlayer error");
        }
      });
    }
    var sendAjaxSettingsChange = () => {
      if (isHost == false)
        return;

      updateLobbySettingsAsHost();

      var send = { ...lobbySettings} 
      if (debug == true)
            console.log(send);

      $.ajax({
        type     : "POST",
        cache    : false,
        url      : "game/settings",
        data     : JSON.stringify(send),
        contentType: "application/json",
        success: function(data, textStatus, jqXHR) {

          if (debug == true)
            console.log("SettingsChange success");
        },
        error: function(jqXHR, status, err) {
          if (debug == true)
            console.log("SettingsChange error");
        }
      });
    }
    var sendAjaxEndGame = () => {
      var send = { } 

      $.ajax({
        type     : "GET",
        cache    : false,
        url      : "game/endGame",
        data     : JSON.stringify(send),
        contentType: "application/json",
        success: function(data, textStatus, jqXHR) {

          if (debug == true)
            console.log("sendAjaxEndGame success");
        },
        error: function(jqXHR, status, err) {
          if (debug == true)
            console.log("sendAjaxEndGame error");
        }
      });
    }
    
    /*   ajax http requests       */
    var ajaxConnectionLoop = ( ) => {
      
      var send = {}
      $.ajax({
        type     : "GET",
        cache    : false,
        url      : "game/connectionLoop",
        data     : JSON.stringify(send),
        contentType: "application/json",
        success: function(data, textStatus, jqXHR) {
          if (debug)
            console.log("connectionLoop success");
          
          updateCheck(data);

          ajaxLoopTimeout = setTimeout(ajaxConnectionLoop,1000);
        },
        error: function(jqXHR, status, err) {
          if (debug)
            console.warn("connectionLoop error");
          ajaxLoopTimeout = setTimeout(ajaxConnectionLoop,1000);
        }
      });
    }
    var ajaxReceiveLobbyChange = ( ) => {
      $('.hideBeforeLoadModal').modal('show');
      var send = {}
      $.ajax({
        type     : "GET",
        cache    : false,
        url      : "game/getLobby",
        data     : JSON.stringify(send),
        contentType: "application/json",
        success: function(data, textStatus, jqXHR) {
          if (debug)
            console.log("ajaxGetLobbyChange success");
          
          $(".hideBeforeLoadModal").on('shown.bs.modal', function() { $(".hideBeforeLoadModal").modal('hide'); }).modal('hide');
          lobbySetupAfterChange(data);
        },
        error: function(jqXHR, status, err) {
          if (debug)
            console.warn("ajaxGetLobbyChange error");
          
          $(".hideBeforeLoadModal").on('shown.bs.modal', function() { $(".hideBeforeLoadModal").modal('hide'); }).modal('hide');
        }
      });
    }
    var ajaxReceiveGameChange = ( ) => {
      $('.hideBeforeLoadModal').modal('show');
      var send = {}
      $.ajax({
        type     : "GET",
        cache    : false,
        url      : "game/getGame",
        data     : JSON.stringify(send),
        contentType: "application/json",
        success: function(data, textStatus, jqXHR) {
          if (debug)
            console.log("ajaxGetLobbyChange success");

          $(".hideBeforeLoadModal").on('shown.bs.modal', function() { $(".hideBeforeLoadModal").modal('hide'); }).modal('hide');
          gameSetupAfterChange(data);
        },
        error: function(jqXHR, status, err) {
          if (debug)
            console.warn("ajaxGetLobbyChange error");
          
          $(".hideBeforeLoadModal").on('shown.bs.modal', function() { $(".hideBeforeLoadModal").modal('hide'); }).modal('hide');
        }
      });
    }
    var ajaxSendAnswerAndReceiveNext = ( answer ) => {
      $('.hideBeforeLoadModal').modal('show');
      var send = {answer: answer}
      $.ajax({
        type     : "POST",
        cache    : false,
        url      : "game/answer",
        data     : JSON.stringify(send),
        contentType: "application/json",
        success: function(data, textStatus, jqXHR) {
          if (debug)
            console.log("ajaxSendAnswerAndReceiveNext success");
          
          $(".hideBeforeLoadModal").on('shown.bs.modal', function() { $(".hideBeforeLoadModal").modal('hide'); }).modal('hide');
          gameSetupAfterChange(data);
        },
        error: function(jqXHR, status, err) {
          if (debug)
            console.warn("ajaxSendAnswerAndReceiveNext error");
          
          $(".hideBeforeLoadModal").on('shown.bs.modal', function() { $(".hideBeforeLoadModal").modal('hide'); }).modal('hide');
        }
      });
    }
    var ajaxReceiveWhoAmI = ( ) => {
      $('.hideBeforeLoadModal').modal('show');
      var send = {}
      $.ajax({
        type     : "GET",
        cache    : false,
        url      : "game/whoAmI",
        data     : JSON.stringify(send),
        contentType: "application/json",
        success: function(data, textStatus, jqXHR) {
          if (debug)
            console.log("ajaxReceiveWhoAmI success");
          
          $(".hideBeforeLoadModal").on('shown.bs.modal', function() { $(".hideBeforeLoadModal").modal('hide'); }).modal('hide');
          lobbyInit(data);
        },
        error: function(jqXHR, status, err) {
          if (debug)
            console.warn("ajaxReceiveWhoAmI error");
          
          $(".hideBeforeLoadModal").on('shown.bs.modal', function() { $(".hideBeforeLoadModal").modal('hide'); }).modal('hide');
        }
      });
    }
    /* debug  */
    var debugSetup = () => {
      if (debug == true) {
        lobbyInit({
          logged: true, 
          isHost : false, 
          nickname: "Gracztestowy", 
          gameStarted: false});
        
        self.gameSetupAfterChange = (game) => {
          gameSetupAfterChange(game);
        }
        self.lobbySetupAfterChange = (lobby) => {
          lobbySetupAfterChange(lobby);
        }
        self.getCurrentTemplateDivId = ()=>{return currentTemplateDivId;}

        self.setupNewTask = setupNewTask;
        self.isHost = isHost;
        self.nickname = nickname;
        self.gameStarted = gameStarted;
      }
    }
    

    /*  initalization  */
    if (debug)
      debugSetup();
    else
      ajaxReceiveWhoAmI();
    
    return self;
  }
  LobbyLogic.create = (debug = false) => {
    
    if (debug) 
      return LobbyLogic(debug = true);

      LobbyLogic();
  }
  LobbyLogic.create();
  //var debug = LobbyLogic.start(debug = true);


  const taskTemplates = [
    {
      taskId: 0,
      nameId: `template0`,
      description: "wstaw odpowiednie słowo w zdaniu",
      textField: "Lorem ipsum dolor sit amet, consectetur [blank] elit. Quisque vestibulum, enim id fringilla sodales, libero ipsum [blank] erat, id ullamcorper elit ante auctor est. Nulla facilisi. Maecenas ultricies, magna non pretium mattis, ligula risus pulvinar elit, eu mattis [blank] dolor nec turpis. Quisque elementum [blank] accumsan. Lorem ipsum dolor [blank] amet, consectetur adipiscing elit. In nec [blank] nisi, et semper nisl. Cras placerat [blank] orci eget congue. Duis vitae gravida odio. Etiam elit turpis, [blank] ac nisi et, dapibus blandit nibh. Duis eleifend metus in iaculis tincidunt.",
      inputSymbolDetectionRegExp: "\\[blank\\]",
      firstLetters: ["a","b","c","d","e","f","g","h"],

    },
    {
      taskId: 1,
      nameId: `template1`,
      description: "odpowiedź true/false",
      textField: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque vestibulum, enim id fringilla sodales, libero ipsum maximus erat, id ullamcorper elit ante auctor est. Nulla facilisi. Maecenas ultricies, magna non pretium mattis, ligula risus pulvinar elit, eu mattis sem dolor nec turpis.",
      questions: ["Nullam gravida pretium finibus. Nam scelerisque ex nec accumsan dictum?",
      "ed consectetur ullamcorper nibh nec laoreet. Etiam scelerisque urna massa?",
      "Nam viverra sit amet arcu sit amet posuere?",
      "Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas?",
      "Nunc vehicula placerat orci, tristique bibendum lacus porta quis?",
      "Duis euismod sollicitudin neque sit amet venenatis?"]
    },
    {
      taskId: 2,
      nameId: `template2`,
      description: "Połącz odpowiednie słowa z definicjami"
    },
    {
      taskId: 3,
      nameId: `template3`,
      description: "połącz słowa z ich synonimami"
    }

  ];

</script>